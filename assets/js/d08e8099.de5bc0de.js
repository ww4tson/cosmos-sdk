"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[7874],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=l(n),u=i,h=m["".concat(p,".").concat(u)]||m[u]||c[u]||a;return n?o.createElement(h,r(r({ref:t},d),{},{components:n})):o.createElement(h,r({ref:t},d))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<a;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},87643:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=n(87462),i=(n(67294),n(3905));const a={sidebar_position:1},r="Vote Extensions",s={unversionedId:"building-apps/vote-extensions",id:"building-apps/vote-extensions",title:"Vote Extensions",description:"This sections describes how the application can define and use vote extensions",source:"@site/docs/building-apps/04-vote-extensions.md",sourceDirName:"building-apps",slug:"/building-apps/vote-extensions",permalink:"/main/building-apps/vote-extensions",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Application Upgrade",permalink:"/main/building-apps/app-upgrade"},next:{title:"Setting up the keyring",permalink:"/main/run-node/keyring"}},p={},l=[{value:"Extend Vote",id:"extend-vote",level:2},{value:"Verify Vote Extension",id:"verify-vote-extension",level:2},{value:"Vote Extension Propagation",id:"vote-extension-propagation",level:2}],d={toc:l};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"vote-extensions"},"Vote Extensions"),(0,i.kt)("admonition",{title:"Synopsis",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"This sections describes how the application can define and use vote extensions\ndefined in ABCI++.")),(0,i.kt)("h2",{id:"extend-vote"},"Extend Vote"),(0,i.kt)("p",null,"ABCI++ allows an application to extend a pre-commit vote with arbitrary data. This\nprocess does NOT have be deterministic and the data returned can be unique to the\nvalidator process. The Cosmos SDK defines ",(0,i.kt)("inlineCode",{parentName:"p"},"baseapp.ExtendVoteHandler"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"type ExtendVoteHandler func(Context, *abci.RequestExtendVote) (*abci.ResponseExtendVote, error)\n")),(0,i.kt)("p",null,"An application can set this handler in ",(0,i.kt)("inlineCode",{parentName:"p"},"app.go")," via the ",(0,i.kt)("inlineCode",{parentName:"p"},"baseapp.SetExtendVoteHandler"),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"BaseApp")," option function. The ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.ExtendVoteHandler"),", if defined, is called during\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"ExtendVote")," ABCI method. Note, if an application decides to implement\n",(0,i.kt)("inlineCode",{parentName:"p"},"baseapp.ExtendVoteHandler"),", it MUST return a non-nil ",(0,i.kt)("inlineCode",{parentName:"p"},"VoteExtension"),". However, the vote\nextension can be empty. See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cometbft/cometbft/blob/v0.38.0-rc1/spec/abci/abci++_methods.md#extendvote"},"here"),"\nfor more details."),(0,i.kt)("p",null,"There are many decentralized censorship-resistant use cases for vote extensions.\nFor example, a validator may want to submit prices for a price oracle or encryption\nshares for an encrypted transaction mempool. Note, an application should be careful\nto consider the size of the vote extensions as they could increase latency in block\nproduction. See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cometbft/cometbft/blob/v0.38.0-rc1/docs/qa/CometBFT-QA-38.md#vote-extensions-testbed"},"here"),"\nfor more details."),(0,i.kt)("h2",{id:"verify-vote-extension"},"Verify Vote Extension"),(0,i.kt)("p",null,"Similar to extending a vote, an application can also verify vote extensions from\nother validators when validating their pre-commits. For a given vote extension,\nthis process MUST be deterministic. The Cosmos SDK defines ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.VerifyVoteExtensionHandler"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-alpha.0/types/abci.go#L26-L27\n")),(0,i.kt)("p",null,"An application can set this handler in ",(0,i.kt)("inlineCode",{parentName:"p"},"app.go")," via the ",(0,i.kt)("inlineCode",{parentName:"p"},"baseapp.SetVerifyVoteExtensionHandler"),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"BaseApp")," option function. The ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.VerifyVoteExtensionHandler"),", if defined, is called\nduring the ",(0,i.kt)("inlineCode",{parentName:"p"},"VerifyVoteExtension")," ABCI method. If an application defines a vote\nextension handler, it should also define a verification handler. Note, not all\nvalidators will share the same view of what vote extensions they verify depending\non how votes are propagated. See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cometbft/cometbft/blob/v0.38.0-rc1/spec/abci/abci++_methods.md#verifyvoteextension"},"here"),"\nfor more details."),(0,i.kt)("h2",{id:"vote-extension-propagation"},"Vote Extension Propagation"),(0,i.kt)("p",null,"The agreed upon vote extensions at height ",(0,i.kt)("inlineCode",{parentName:"p"},"H")," are provided to the proposing validator\nat height ",(0,i.kt)("inlineCode",{parentName:"p"},"H+1")," during ",(0,i.kt)("inlineCode",{parentName:"p"},"PrepareProposal"),". As a result, the vote extensions are\nnot natively provided or exposed to the remaining validators during ",(0,i.kt)("inlineCode",{parentName:"p"},"ProcessProposal"),".\nAs a result, if an application requires that the agreed upon vote extensions from\nheight ",(0,i.kt)("inlineCode",{parentName:"p"},"H")," are available to all validators at ",(0,i.kt)("inlineCode",{parentName:"p"},"H+1"),', the application must propagate\nthese vote extensions manually in the block proposal itself. This can be done by\n"injecting" them into the block proposal, since the ',(0,i.kt)("inlineCode",{parentName:"p"},"Txs")," field in ",(0,i.kt)("inlineCode",{parentName:"p"},"PrepareProposal"),"\nis just a slice of byte slices."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"FinalizeBlock")," will ignore any byte slice that doesn't implement an ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.Tx")," so\nany injected vote extensions will safely be ignored in ",(0,i.kt)("inlineCode",{parentName:"p"},"FinalizeBlock"),". For more\ndetails on propagation, see the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/main/docs/architecture/adr-064-abci-2.0.md#vote-extension-propagation--verification"},"ABCI++ 2.0 ADR"),"."))}c.isMDXComponent=!0}}]);